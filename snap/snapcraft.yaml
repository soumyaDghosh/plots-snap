name: plots # you probably want to 'snapcraft register <name>'
base: core22 # the base snap is the execution environment for this snap
version: '0.8.4' # just for humans, typically '1.2+git' or '1.3.2'
adopt-info: plots
icon: snap/gui/plots.svg
grade: devel # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots
architectures:
  - build-on: amd64
  - build-on: arm64
  - build-on: armhf
plugs:
  plots:
    interface: dbus
    bus: session
    name: com.github.alexhuntley.Plots

#environment:
  # WORKAROUND: Add python modules in Snap to search path
#  PYTHONPATH: ${SNAP}/lib/python3.10/site-packages:${SNAP}/usr/lib/python3/dist-packages
parts:
  plots:
    # See 'snapcraft plugins'
    plugin: python
    source: https://github.com/alexhuntley/Plots.git
    source-tag: v${SNAPCRAFT_PROJECT_VERSION}
    build-environment:
      # WORKAROUND: The python plugin is broken with gnome extension
      - PATH: ${CRAFT_PART_INSTALL}/bin:${PATH}
      - PYTHONPATH: ""
    stage:
      # WORKAROUND: Skip venv from python plugin
      - -bin/activate
      - -bin/activate.csh
      - -bin/activate.fish
      - -bin/Activate.ps1
      - -bin/python
      - -bin/python3
      - -bin/python3.10
      - -bin/pip
      - -bin/pip3
      - -pyvenv.cfg
    python-packages:
      - PyOpenGL
      - numpy
      - lark
      - PyGLM
      - freetype-py
    build-packages:
      - python3-jinja2
    override-build: |
      craftctl default
      # WORKAROUND: Use python from search path, the path detected by meson doesn't exist when running the Snap
      install -D $CRAFT_PART_SRC/res/com.github.alexhuntley.Plots.metainfo.xml -t $CRAFT_PART_INSTALL/share/metainfo/
      install -D -t $CRAFT_PART_INSTALL/share/help/C/plots/ $CRAFT_PART_SRC/C/*
      install -D -t $CRAFT_PART_INSTALL/share/help/de/plots/ $CRAFT_PART_SRC/de/*
      install -D -t $CRAFT_PART_INSTALL/share/help/es/plots/ $CRAFT_PART_SRC/es/*
      install -D -t $CRAFT_PART_INSTALL/share/help/fa/plots/ $CRAFT_PART_SRC/fa/*
      install -D -t $CRAFT_PART_INSTALL/share/help/fr/plots/ $CRAFT_PART_SRC/fr/*
      install -D -t $CRAFT_PART_INSTALL/share/help/hr/plots/ $CRAFT_PART_SRC/hr/*
      install -D -t $CRAFT_PART_INSTALL/share/help/hu/plots/ $CRAFT_PART_SRC/hu/*
      install -D -t $CRAFT_PART_INSTALL/share/help/it/plots/ $CRAFT_PART_SRC/it/*
      install -D -t $CRAFT_PART_INSTALL/share/help/nb_NO/plots/ $CRAFT_PART_SRC/nb_NO/*
      install -D -t $CRAFT_PART_INSTALL/share/help/nl/plots/ $CRAFT_PART_SRC/nl/*
      install -D -t $CRAFT_PART_INSTALL/share/help/pt_BR/plots/ $CRAFT_PART_SRC/pt_BR/*
      install -D -t $CRAFT_PART_INSTALL/share/help/zh_Hans/plots/ $CRAFT_PART_SRC/zh_Hans/*
    parse-info: [share/metainfo/com.github.alexhuntley.Plots.metainfo.xml]
apps:
  plots:
    command: bin/plots
    extensions: [gnome]
    common-id: com.github.alexhuntley.Plots
    plugs:
      - home
